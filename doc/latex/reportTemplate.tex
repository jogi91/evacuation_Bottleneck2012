\documentclass[11pt]{article}
\usepackage{geometry}                
\geometry{letterpaper}                   

\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
%\usepackage{natbib}
\usepackage{amssymb, amsmath}
\usepackage{hyperref}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

%\title{Title}
%\author{Name 1, Name 2}
%\date{date} 

\begin{document}


\input{cover}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Agreement for free-download}
\bigskip


\bigskip


\large We hereby agree to make our source code for this project freely
available for download from the web pages of the SOMS chair. Furthermore, we
assure that all source code is written by ourselves and is not violating any
copyright restrictions.

\begin{center}

\bigskip


\bigskip


\begin{tabular}{@{}p{3.3cm}@{}p{6cm}@{}@{}p{6cm}@{}}
\begin{minipage}{3cm}

\end{minipage}
&
\begin{minipage}{6cm}
\vspace{2mm} \large Johannes Weinbuch

 \vspace{\baselineskip}

\end{minipage}
&
\begin{minipage}{6cm}

\large Benedek Vartok

\end{minipage}
\end{tabular}


\end{center}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% IMPORTANT
% you MUST include the ETH declaration of originality here; it is available for
% download on the course website or at
% http://www.ethz.ch/faculty/exams/plagiarism/index_EN; it can be printed as
% pdf and should be filled out in handwriting


%%%%%%%%%% Table of content %%%%%%%%%%%%%%%%%

\tableofcontents

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{Abstract}

This work takes a look into the evacuation mechanisms of a cruise ship in case
of an emergency.  A simple model is implemented which is used to simulate the
dynamics of such a system.  The main emphasis was on the limited capacity of
the exits, since that is the key element for a rescue boat. 


\section{Individual contributions}

The work on this project was split among us to fit our strengths the best way
possible.  Because of his knowledge in image editing and formats, Johannes
Weinbuch focused on the image manipulation for the input and implemented the
loading of the image into MATLAB, improving the existing solutions from the
previous courses. He further took a large part of the writing for the report
and executing the simulations, which were written by Benedek Vartok.  He
evaluated which code from previous semesters could and should be reused, and
implemented the missing parts for our special case.  Also, he wrote the output
mechanisms for the simulation, so that the data could be used for analysis.


\section{Introduction and Motivations}

In January 2012, the Costa Concordia hit a rock and ran aground\cite{bbcnews}.
This event got great media attention for a long time so we decided to take a
closer look at the evacuation of a cruise ship.  The question is, what is the
best stratgy to leave the ship?  This question should for sure be answered with
one of the emergency drills, but it is always good to have some background
knowledge.


\section{Description of the Model}

The model is a big simplification of real life, otherwise it would be way too
complex to simulate.  It assumes that the ship is intact, that there is calm
sea and that the passengers are obliged to leave the ship.  A possible
explanation for this could be a machine defect which leaks explosive gas in a
badly ventilated room in the ship.  Further, we assume that the rescue boats are
like doors, which close after a certain amount of people going through them. 

Since we also assume that the other doors, for example between the rooms or
floors, are constantly open and working, we only simulate one deck, the one
with the exits to the rescue boats.  The evacuation of multiple floors in a
static building has already been researched in \cite{multilevel}. 

After these simplifications, the task left to simulate was the evacuation of a
single floor with some elements that can change.  For this task, we chose a
simple agend based modelling solution as described in \cite{helbing}.  A
passenger is treated as a particle.  It has a mass, and there are physical and
social forces, accelerating that mass so that it cannot always follow its
desired direction.  The desired direction is implemented as the shortest path
to the nearest exit.  For the exact formulae for the forces see
section~\ref{sub:movement}.

\section{Implementation}

\subsection{Input}

\label{sub:input}

Since we had some good projects which covered similar
problems as ours, we could get some ideas from them, but at the same time
improve them.  Namely, there are \cite{multilevel} and \cite{airplane}.  As far
as the input for the simulation is concerned, we see two approaches in these
works for getting the map data into the simulation.  In \cite{multilevel}, a
simple PNG image is used to get a map into the simulation. The problem here is
that only a certain RGB color value can be read out of the image.  This can
lead to problems if the image is processed with automatic or semiautomatic
image manipulation programs, since only a minor difference in color can prevent
the generation of the desired data.  In \cite{airplane}, the image format is
even more simple.  There is only a bitmap image read into MATLAB.  Since the
bitmap images can use a colormap, MATLAB doesn't use 3 channels but a unique
number for each color in an image matrix to give every pixel its color.  This
has the same problem as the PNG solution regarding how exactly the colors have
to be set, but the different parts of the image can be separated with less
code.

We took the best of both solutions. We used the PNG-format with indexed colors.
So we have the most flexibility with very little usage of disk space.  There is
no special ``wall color'' or anything like that, just a simple rule how the
colormap is read: Color 0 of the map specifies walls, color 1 free space.
Then, there can be any number of spawn zones.  Spawn zones are the areas in the
image, where new agents can be placed. With different spawn zones, it is
possible to account for different situations: A ballroom is different from a
staircase.  The number of spawn zones is specified in the configuration file.
At last, there is an arbitrary number of exits.  Again, each exit can have its
own parameters or can even be handled specially in the program's code. 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{images/gimp.png}
	\caption{Screenshot of the Rearrange Colormap dialog in Gimp 2.6.11}
	\label{gimpscreenshot}
	
\end{figure}
To manipulate the colormap, any slightly sophisticated image manipulation
program should suffice. We used the free software Gimp \cite{gimp}. It has a
very convenient command which allows the user to rearrange the colormap. This
is shown in figure~\ref{gimpscreenshot}.

\subsection{The Simulation Routines}
\label{sub:The simulation Routines}

\subsubsection{Code Reuse from Multilevel Evacuation}

Since this project has very similar foundations as \cite{multilevel} (like the
forces used in the model), we were able to use a lot of code from their
repository.  Some of the structure needed to be changed to implement our custom
features, but for example the utility functions for the Fast Sweeping algorithm
and the linear interpolation which the other group wrote in C were copied 1:1
into our code-tree.

\subsubsection{General Structure}

During the entire program run, one single big structure is used to hold and
pass around the state of the simulation.

At first, this structure is initialized with the fields that are given in the
configuration file by \texttt{loadConfig}.  Then, \texttt{initialize} runs over
the struct and calculates some data needed in the simulation, such as the
vector fields needed for the wall and exit force fields using the
\texttt{fastSweeping} method which we got from \cite{multilevel}.

\subsubsection{Main Loop}

\texttt{simulate} is the routine we call when we do an entire simulation.  It
uses the \texttt{loadConfig} and \texttt{initialize} functions to initialize
its runtime data, then it does the loop calculating forces, adding new agents,
progressing the agents, updating the exit vector fields, potentially plotting
and saving frames and collecting data.

These steps will be explained in detail in the following sections.

\subsubsection{Agent Placement}

As mentioned in section~\ref{sub:input}, our model of the ship has different
spawning zones where new agents can start out at.  The way we implemented it,
in every step of the simulation loop it is checked whether there are any
remaining agents that need to be placed (i.e. agents which are not in the
simulation yet).  If there are, then for every agent the program chooses a
random point in the spawning zones and places him there, unless it detects that
the agent would collide either with walls or other agents.  In that case, the
routine tries the placement for that agent up to five times, each time with a
new random position.  If the agent couldn't be placed, then he will have a
chance to spawn in the next time step.

This method was implemented in \texttt{placeAgents}.  In the same method, the
basic properties of the agent get assigned, like the starting zero velocity and
a random radius.

\subsubsection{Agent Dynamics}
\label{sub:movement}

To simulate the movement of the agents in this physical model, different forces
need to be calculated in every step on every agent.  These forces have been
separated into the following functions which \texttt{simulate} calls:

\begin{description}

\item[\texttt{addDesiredForces}] is responsible for making the agents seek the
exits of the layout, in our case the rescue boats.
% TODO

\end{description}

\subsection{Output}
\label{sub:output}

\section{Simulation Results and Discussion}

\section{Summary and Outlook}

\section{References}
\bibliographystyle{plainnat}


\begingroup 
\renewcommand{\section}[2]{}%
\begin{thebibliography}{9}

	\bibitem{bbcnews}
		\url{http://www.bbc.co.uk/news/world-europe-16563562}, 9.12.2012
	\bibitem{multilevel}
	\emph{Modelling Situations of Evacuation
in a Multi-level Building} , 
Hans Hardmeier, Andrin Jenal, Beat Küng, Felix Thaler, Zurich, April 2012
	\bibitem{helbing}
		\emph{Simulating dynamical features of escape panic},
		Dirk Helbing, Ill\'es Farkas, Tam\'as Vicsek, Nature, 28. September 2000
	\bibitem{airplane}
		\emph{Pedestrian Dynamics Airplane Evacuation Simulation},
		Philipp Heer, Lukas Bühler, Zurich, May 2011
	\bibitem{gimp}
		\url{http://www.gimp.org/}, 9.12.2012
\end{thebibliography}
\endgroup



\end{document}  



 
